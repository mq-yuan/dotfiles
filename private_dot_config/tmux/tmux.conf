# ==========================================
# General Settings
# ==========================================

# Enable colors and mouse support
set -g default-terminal "tmux-256color"
set -g mouse on

# Increase scrollback buffer size
set -g history-limit 10000

# Start numbering at 1 instead of 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows automatically when one is closed
set -g renumber-windows on

# ==========================================
# Catppuccin Theme Configuration
# ==========================================

# Theme options
set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "rounded"

# Load the theme manually (managed via chezmoi external)
run ~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux

# Status bar options
set -g status-right-length 100
set -g status-left-length 100
set -g status-left ""

# Status bar modules
set -g status-right "#{E:@catppuccin_status_application}"
set -agF status-right "#{E:@catppuccin_status_cpu}"
set -ag status-right "#{E:@catppuccin_status_session}"
set -ag status-right "#{E:@catppuccin_status_uptime}"

# Load dependencies (managed via chezmoi external)
run ~/.config/tmux/plugins/tmux-plugins/tmux-cpu/cpu.tmux

# ==========================================
# Key Bindings: Window Management
# ==========================================

# Switch windows using [ and ]
bind -r [ previous-window
bind -r ] next-window

# Go to the last active window (using - instead of l)
bind - last-window

# List and choose windows
bind w choose-tree -w

# ==========================================
# Key Bindings: Copy Mode (Vim Style)
# ==========================================

# Use Escape to enter copy mode (since [ is used for windows)
bind Escape copy-mode

# Use vi key bindings
setw -g mode-keys vi

# Vim-like selection and copying
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi V send-keys -X select-line
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Y send-keys -X copy-line

# ==========================================
# Key Bindings: Pane Management
# ==========================================

# Split panes (keep default)
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# Vim-like pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes using Arrow keys
bind -r Up resize-pane -U 5
bind -r Down resize-pane -D 5
bind -r Left resize-pane -L 5
bind -r Right resize-pane -R 5

# ==========================================
# Key Bindings: Session Management
# ==========================================

# List and choose sessions
bind s choose-tree -s

# Quick switch sessions using Tab / Shift+Tab
bind -r Tab switch-client -n
bind -r BTab switch-client -p

# Jump to last active session using Backspace
bind BSpace switch-client -l

# Rename current session
bind , command-prompt -I "#S" "rename-session '%%'"
